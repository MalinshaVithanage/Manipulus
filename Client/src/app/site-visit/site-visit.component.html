<nav class="navbar navbar-expand-lg navbar-dark bg-secondary">
    <ul class="navbar-nav mr-auto">
    <a class="navbar-brand" href="#" style="color:white;" >Site Visit</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarColor02">
       
        <div class="col-xl-6 col-md-6">
        <!-- Add "add site Visits" button -->
          <li class="nav-item active">
            <button 
            type="button"
            class="btn btn-outline-primary"
            data-bs-toggle="modal"
            data-bs-target="#exampleModal55">Site Visit</button>
            <!-- <a class="nav-link" (click)="onOpenModal(null,'add')" data-bs-toggle="modal" data-bs-target="#exampleModal"  style="background-color: rgb(149, 158, 167); border-color: rgb(80, 9, 15);">Add SiteVisit <span class="sr-only"> </span></a> -->
            <!-- <a class="nav-link" (click)="onOpenModal(null,'add')" data-toggle="modal" data-target="#exampleModal"  style="background-color: rgb(149, 158, 167); border-color: rgb(80, 9, 15);">Add SiteVisit <span class="sr-only"> </span></a> -->
          </li>
</div>
        <!-- Add Search Bar -->
        <div class="col-xl-6 col-md-6">
          <li class="nav-item">
       <form class="form-inline my-2 my-lg-0 ml-auto">
        <input type="search" (ngModelChange)="searchSiteVisits(key.value)" #key="ngModel" ngModel
         name="key" id="searchName" class="form-control mr-sm-2" placeholder="Search siteVisits..." required>  
        </form>
        </li>
       </div>
    </div>
</ul>
  </nav>
<div class="container"id="main-container">
    <div class="row">

        <!-- Add Total site visit card -->
        <div class="col-xl-3 col-md-6">
            <div class="card-box bg-pattern">
                <div class="card-body">
                    
                    <div class="icon">
                        <i class="fa fa-table" aria-hidden="true"></i>
                    </div>
                    <h3  class="inner">{{ totalSiteVisitsCount}}</h3>
                    <p class="card-box-footer">Total Site Visits</p>
                </div>
            </div>
        </div>
        
        <!-- Add Completed site visit card -->
         <div class="col-xl-3 col-md-6">
            <div class="card-box bg-pattern">
                <div class="card-body">
                    
                    <div class="icon">
                        <i class="fa fa-trophy" aria-hidden="true"></i>
                    </div>
                    <h3  class="inner">{{ completedSiteVisitsCount }}</h3>
                    <p class="card-box-footer">Completed Site Visits</p>
                </div>
            </div>
        </div>

       <!-- Add incompleted site visit card -->
       <div class="col-xl-3 col-md-6">
        <div class="card-box bg-pattern">
            <div class="card-body">
                
                <div class="icon">
                    <i class="fa fa-truck" aria-hidden="true"></i>
                </div>
                <h3  class="inner">{{incompleteSiteVisitsCount}}</h3>
                <p class="card-box-footer">Pending Site Visits</p>
            </div>
        </div>
    </div>
       


    <!-- Create the site visit table -->
    <div class="row">
        <div *ngFor="let siteVisit of siteVisits; let i = index" class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive siteVisit-list">
                        <table class="table siteVisit-table table-centered table-nowrap">
                            <!-- Create header of the table -->
                            <thead> 
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Site Visits</th>
                                    <th scope="col">Scheduled Date</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Team</th>
                                    <th scope="col">Vehicle</th>
                                    <th scope="col">End Date</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <!-- Create body of the table -->
                            <tbody>
                                <tr>
                                    <th scope="row">{{i+1}}</th>
                                    <td>{{siteVisit?.siteVisitId}}</td>
                                    
                                    <td>{{siteVisit?.scheduledDate | date: 'yyyy-MM-dd'}}</td>

                                    <td>
                                        <span class="text-success font-12"><i class="mdi mdi-checkbox-blank-circle mr-1"></i> {{siteVisit?.state}}</span>
                                    </td>
                                     <td>{{ siteVisit?.assignedTeamId }}</td> 
                                    

                                    <td>{{siteVisit?.assignedVehicle}}</td> 
                                    <!-- <td>
                                        <ul>
                                            <li *ngFor="let vehicle of siteVisit.vehicles">{{ vehicle.id }}</li>

                                          <li *ngFor="let vehicle of siteVisit.vehicles">{{ Vehicle. vehicle_name }}</li> 
                                        </ul>
                                        </td> -->
                                    <td>{{siteVisit?.dateRange | date: 'yyyy-MM-dd'}}</td>
                                    <td>
                                        <div class="action">
                                            <td>  <button (click)="onOpenModal(siteVisit,'edit')" class="btn btn-primary tooltips" data-placement="top" data-original-title="Edit" style="background-color: rgb(10, 80, 25); border-color: rgb(9, 80, 22);"> 
                                                <i class="fas fa-pencil-alt"></i></button>
                                            </td>
                                            <td> <a (click)="onOpenModal(siteVisit,'delete')" class="btn btn-secondary tooltips" data-placement="top" title="" data-original-title="delete" style="background-color: rgb(189, 12, 12); border-color: rgb(116, 106, 106);"> <i class="fas fa-trash"></i>
                                            </a></td>
                                            <!-- <td><a (click)="onOpenModal(siteVisit,'print')" class="btn btn-secondary tooltips" data-placement="top" title="print" data-original-title="print" style="background-color: rgb(134, 122, 122); border-color: rgb(116, 106, 106);"><i class="fa fa-print"></i></a></td> -->
                                            <!-- your-component.component.html -->
                                            <!-- <td><button (click)="downloadPDF()"  class="btn btn-secondary tooltips" data-placement="top" title="Print Gate Pass" data-original-title="print" style="background-color: rgb(134, 122, 122); border-color: rgb(116, 106, 106);"><i class="fa fa-download"></i></button></td> -->
                                            

                                            <td>
                                                <button (click)="downloadPDF(siteVisit.siteVisitId)" class="btn btn-secondary tooltips" data-placement="top" title="Print Gate Pass" data-original-title="print" style="background-color: rgb(134, 122, 122); border-color: rgb(116, 106, 106);">
                                                  <i class="fa fa-download"></i>
                                                </button>
                                              </td>
                                              
  
                                         </div>
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- end project-list -->
   
<!-- Add Site Visit Modal -->
<form #addForm="ngForm" (ngSubmit)="onAddSiteVisit(addForm)">
<div class="modal fade" 
    id="exampleModal55" 
    tabindex="-1" 
    role="dialog" 
    aria-labelledby="exampleModalLabel" 
    aria-hidden="true"
    >

    <div class="modal-dialog">
      <div class="modal-content"> 
        <!-- <form #addForm="ngForm" (ngSubmit)="onAddSiteVisit(addForm)"> -->
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add SiteVisit</h5>
          <button 
          type="button" 
          class="btn-close" 
          data-dismiss="modal" 
          aria-label="Close">
            <!-- <span aria-hidden="true">&times;</span> -->
          </button>
        </div>
        <div class="modal-body">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">

          <!-- <form #addForm="ngForm" (ngSubmit)="onAddSiteVisit(addForm)"> -->
         <div class="form-group">
              <label for="scheduledDate">Scheduled Date</label>
              <input type="date" ngModel name="scheduledDate" class="form-control" id="email" placeholder="scheduledDate" required>
            </div>
            <div class="form-group">
              <label for="assignedTeamId">Assigned Team Id</label>
              <input type="text" ngModel name="assignedTeamId" class="form-control" id="assignedTeamId" placeholder="assignedTeamId" required>
            </div>
                        <div class="form-group">
                        <label for="activeStatus">Active Status of Available Vehicles</label>
                        <div class="active-status-container">
                            <div *ngFor="let vehicle of availableVehicles" class="active-status-row">
                                Vehicle No: {{ vehicle.vehicle_number }} | Active Status: {{ vehicle.active_state }}
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="assignedVehicle">Assign Vehicle</label>  
                              <label for="assignedVehicle">Vehicle No:</label>
                            <input type="text" ngModel name="assignedVehicle" class="form-control" id="assignedVehicle" placeholder="Assign a vehicle" required>
                      </div>

            <div class="form-group">
              <label for="dateRange">End Date</label>
              <input type="date" ngModel name="dateRange" class="form-control" id="dateRange" placeholder="dateRange" required>
            </div>

            <div class="form-group">
              <label for="state">Status</label>
              <select id="state" [(ngModel)]="state" name="state" class="form-control" required>
                <option value="Pending">Pending</option>
                <option value="Completed">Completed</option>
              </select>
            </div>

            <div class="modal-footer">
              <button type="button" id="add-siteVisit-form" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button [disabled]="addForm.invalid" type="submit" class="btn btn-primary">Save</button>
            </div>
        </div>
                </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</form>

<!-- Edit Modal -->
<div class="modal fade" id="updateSiteVisitModal" tabindex="-1" role="dialog" aria-labelledby="siteVisitEditModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
             <form #editForm="ngForm" >
           <div class="modal-header">
              <h5 class="modal-title" id="updateSiteVisitModalLabel">Edit Site Visit {{editSiteVisits?.siteVisitId}}</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
              </button>
           </div>

           <div class="modal-body">
              <!-- <form #editForm="ngForm"> -->
                
                <input type="hidden" ngModel="{{editSiteVisits?.siteVisitId}}" name="siteVisitId" class="form-control" id="SiteVisitId" placeholder="siteVisitId">

                
                 <div class="form-group">
                    <label for="assignedTeamId">Assigned Team Id</label>
                    <input  ngModel="{{editSiteVisits?.assignedTeamId}}" name="assignedTeamId" class="form-control" id="assignedTeamId" placeholder="assignedTeamId">
                 </div>
                 <!-- <div class="form-group">
                    <label for="assignedVehicle">Assigned Vehicle</label>
                    <input type="text" ngModel="{{editSiteVisits?.vehicles}}" name="assignedVehicle" class="form-control" id="assignedVehicle" name="assignedVehicle" placeholder="assignedVehicle">
                 </div> -->

                   
                 <div class="form-group">
                    <br>
                    <i>Active Status of Available Vehicles</i>
                    <div class="active-status-container">
                        <div *ngFor="let vehicle of availableVehicles" class="active-status-row">
                            Vehicle No: {{ vehicle.vehicle_number }} | Active Status: {{ vehicle.active_state }}
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="assignedVehicle">Assign Vehicle</label>  
                          <label for="assignedVehicle">Vehicle No:</label>
                        <input  ngModel="{{editSiteVisits?.assignedVehicle}}" name="assignedVehicle" class="form-control" id="assignedVehicle" placeholder="Assign a vehicle" required>
                  </div>
                  <br>
                 <i>If you wish to edit dates Please enter the Status as completed and save it. After that Enter the dates you wish to edit and Save.</i>
                 
                  <div class="form-group">
                    <label for="scheduledDate">Scheduled Date</label>
                    <input ngModel="{{editSiteVisits?.scheduledDate}}" name="scheduledDate" class="form-control" id="scheduledDate" placeholder="Schedule a Date">
                 </div>
                 <div class="form-group">
                    <label for="dateRange">End Date</label>
                    <input ngModel="{{editSiteVisits?.dateRange}}" name="dateRange" class="form-control" id="dateRange" placeholder="End Date">
                 </div>
                
                 <div class="form-group">
                    <label for="state">Status</label>
                    <select id="state" [(ngModel)]="state" name="state" class="form-control" required>
                      <option value="Pending">Pending</option>
                      <option value="Completed">Completed</option>
                    </select>
                  </div>
                 <div class="modal-footer">
                    <button type="button" id="" data-dismiss="modal" class="btn btn-secondary">Close</button>
                    <button (click)="onUpdateSiteVisit(editForm.value)" data-dismiss="modal" class="btn btn-primary">
                        Save changes
                      </button>
                      <p *ngIf="!editSiteVisits?.siteVisitId" class="text-danger">Please enter a siteVisitId.</p>
                      
                 </div>
            
           </div>
        </form>
        </div>
     </div>
</div>

<!-- Delete Modal -->
    <div class="modal fade" id="deleteSiteVisitModal" tabindex="-1" role="dialog" aria-labelledby="deleteModelLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModelLabel">Delete SiteVisit</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete siteVisit {{deleteSiteVisits?.siteVisitId}}?</p>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                        <button (click)="deleteSiteVisits?.siteVisitId && onDeleteSiteVisit(deleteSiteVisits.siteVisitId)" class="btn btn-danger" data-dismiss="modal">Yes</button>

                    </div>
                </div>
           </div>
        </div>
    </div>
    </div>




     
  
            
  

